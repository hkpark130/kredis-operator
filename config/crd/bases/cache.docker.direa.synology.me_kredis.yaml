---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.1
  name: kredis.cache.docker.direa.synology.me
spec:
  group: cache.docker.direa.synology.me
  names:
    kind: Kredis
    listKind: KredisList
    plural: kredis
    singular: kredis
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Number of master nodes
      jsonPath: .spec.masters
      name: Masters
      type: integer
    - description: Number of replicas per master
      jsonPath: .spec.replicas
      name: Replicas
      type: integer
    - description: Current cluster state
      jsonPath: .status.clusterState
      name: State
      type: string
    - description: Ready replicas
      jsonPath: .status.readyReplicas
      name: Ready
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Kredis is the Schema for the kredis API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: KredisSpec defines the desired state of Kredis
            properties:
              autoscaling:
                description: Autoscaling configuration for the Redis cluster
                properties:
                  cpuScaleDownThreshold:
                    description: |-
                      CPUScaleDownThreshold is the CPU usage percentage to trigger replica scale down (0-100)
                      When CPU usage falls below this threshold, replicas may be scaled down
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  cpuScaleUpThreshold:
                    description: |-
                      CPUScaleUpThreshold is the CPU usage percentage to trigger replica scale up (0-100)
                      When CPU usage exceeds this threshold, replicas are scaled up
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  enabled:
                    description: Enabled enables autoscaling
                    type: boolean
                  maxMasters:
                    description: MaxMasters is the maximum number of master nodes
                    format: int32
                    minimum: 3
                    type: integer
                  maxReplicasPerMaster:
                    description: MaxReplicasPerMaster is the maximum number of replicas
                      per master
                    format: int32
                    minimum: 0
                    type: integer
                  memoryScaleDownThreshold:
                    description: |-
                      MemoryScaleDownThreshold is the memory usage percentage to trigger master scale down (0-100)
                      When memory usage falls below this threshold, masters may be scaled down
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  memoryScaleUpThreshold:
                    description: |-
                      MemoryScaleUpThreshold is the memory usage percentage to trigger master scale up (0-100)
                      When memory usage exceeds this threshold, masters are scaled up
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                  minMasters:
                    description: MinMasters is the minimum number of master nodes
                    format: int32
                    minimum: 3
                    type: integer
                  minReplicasPerMaster:
                    description: MinReplicasPerMaster is the minimum number of replicas
                      per master
                    format: int32
                    minimum: 0
                    type: integer
                  scaleDownStabilizationWindowSeconds:
                    default: 300
                    description: ScaleDownStabilizationWindowSeconds is the time window
                      to wait before scaling down
                    format: int32
                    type: integer
                  scaleUpStabilizationWindowSeconds:
                    default: 60
                    description: ScaleUpStabilizationWindowSeconds is the time window
                      to wait before scaling up
                    format: int32
                    type: integer
                type: object
              basePort:
                description: Base Port for Redis
                format: int32
                type: integer
              exporter:
                description: Exporter configuration for Prometheus metrics
                properties:
                  enabled:
                    description: Enabled enables redis-exporter sidecar for Prometheus
                      metrics
                    type: boolean
                  image:
                    default: bitnami/redis-exporter:latest
                    description: Image is the redis-exporter container image
                    type: string
                  port:
                    default: 9121
                    description: Port is the exporter metrics port
                    format: int32
                    type: integer
                type: object
              image:
                description: Redis container image
                type: string
              masters:
                description: Redis Master Node count
                format: int32
                type: integer
              maxMemory:
                description: 'MaxMemory: Redis maxmemory 설정 (예: "512mb", "1gb"). 비우면
                  제한 미적용.'
                type: string
              replicas:
                description: Redis Replica Node count
                format: int32
                type: integer
              resources:
                description: Resource requirements
                properties:
                  limits:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: Limits describes the maximum amount of compute resources
                      allowed.
                    type: object
                  requests:
                    additionalProperties:
                      anyOf:
                      - type: integer
                      - type: string
                      pattern: ^(\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))(([KMGTPE]i)|[numkMGTPE]|([eE](\+|-)?(([0-9]+(\.[0-9]*)?)|(\.[0-9]+))))?$
                      x-kubernetes-int-or-string: true
                    description: Requests describes the minimum amount of compute
                      resources required.
                    type: object
                type: object
            required:
            - basePort
            - image
            - masters
            - replicas
            type: object
          status:
            description: KredisStatus defines the observed state of Kredis
            properties:
              clusterNodes:
                description: ClusterNodes contains information about cluster nodes
                items:
                  description: ClusterNode represents a Redis node in the cluster
                  properties:
                    ip:
                      description: IP is the pod IP address
                      type: string
                    masterId:
                      description: MasterID is the master node ID if this is a slave
                      type: string
                    nodeId:
                      description: NodeID is the Redis cluster node ID
                      type: string
                    podName:
                      description: PodName is the Kubernetes pod name
                      type: string
                    port:
                      description: Port is the Redis port
                      format: int32
                      type: integer
                    role:
                      description: Role is either "master" or "slave"
                      type: string
                    slotCount:
                      description: SlotCount is the number of slots assigned to this
                        node (masters only)
                      type: integer
                    status:
                      description: Status is the node status (e.g., "ready", "failed",
                        "pending")
                      type: string
                  required:
                  - ip
                  - podName
                  - port
                  - role
                  - status
                  type: object
                type: array
              clusterState:
                description: ClusterState represents the Redis cluster initialization
                  state
                type: string
              conditions:
                description: Conditions represent the latest available observations
                items:
                  description: Condition contains details for one aspect of the current
                    state of this API Resource.
                  properties:
                    lastTransitionTime:
                      description: |-
                        lastTransitionTime is the last time the condition transitioned from one status to another.
                        This should be when the underlying condition changed.  If that is not known, then using the time when the API field changed is acceptable.
                      format: date-time
                      type: string
                    message:
                      description: |-
                        message is a human readable message indicating details about the transition.
                        This may be an empty string.
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: |-
                        observedGeneration represents the .metadata.generation that the condition was set based upon.
                        For instance, if .metadata.generation is currently 12, but the .status.conditions[x].observedGeneration is 9, the condition is out of date
                        with respect to the current state of the instance.
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: |-
                        reason contains a programmatic identifier indicating the reason for the condition's last transition.
                        Producers of specific condition types may define expected values and meanings for this field,
                        and whether the values are considered a guaranteed API.
                        The value should be a CamelCase string.
                        This field may not be empty.
                      maxLength: 1024
                      minLength: 1
                      pattern: ^[A-Za-z]([A-Za-z0-9_,:]*[A-Za-z0-9_])?$
                      type: string
                    status:
                      description: status of the condition, one of True, False, Unknown.
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: type of condition in CamelCase or in foo.example.com/CamelCase.
                      maxLength: 316
                      pattern: ^([a-z0-9]([-a-z0-9]*[a-z0-9])?(\.[a-z0-9]([-a-z0-9]*[a-z0-9])?)*/)?(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])$
                      type: string
                  required:
                  - lastTransitionTime
                  - message
                  - reason
                  - status
                  - type
                  type: object
                type: array
              currentCpuUsagePercent:
                description: CurrentCPUUsagePercent is the current average CPU usage
                  percentage across all nodes
                format: int32
                type: integer
              currentMemoryUsagePercent:
                description: CurrentMemoryUsagePercent is the current average memory
                  usage percentage across masters
                format: int32
                type: integer
              joinedPods:
                description: JoinedPods contains the list of pod names that have joined
                  the cluster
                items:
                  type: string
                type: array
              knownClusterNodes:
                description: KnownClusterNodes represents the number of nodes in the
                  cluster
                type: integer
              lastClusterOperation:
                description: LastClusterOperation tracks the last cluster operation
                  performed
                type: string
              lastScaleTime:
                description: LastScaleTime is the last time the cluster was scaled
                format: date-time
                type: string
              lastScaleType:
                description: LastScaleType indicates the last scale operation type
                  (masters-up, masters-down, replicas-up, replicas-down)
                type: string
              pendingScaleDown:
                description: |-
                  PendingScaleDown contains nodes waiting to be removed from the cluster.
                  These nodes must complete data migration (reshard) and cluster forget before pod deletion.
                  Format: list of node IDs that are being removed
                items:
                  description: ScaleDownNode represents a node being removed during
                    scale-down
                  properties:
                    nodeId:
                      description: NodeID is the Redis cluster node ID to be removed
                      type: string
                    phase:
                      description: |-
                        Phase indicates the current phase of scale-down for this node
                        Values: pending, resharding, forgetting, completed
                      type: string
                    podName:
                      description: PodName is the name of the pod to be deleted
                      type: string
                    role:
                      description: Role is the role of the node (master/slave)
                      type: string
                    slotsMigrated:
                      description: SlotsMigrated indicates how many slots have been
                        migrated (for masters)
                      type: integer
                  required:
                  - nodeId
                  - phase
                  - podName
                  - role
                  type: object
                type: array
              phase:
                description: Phase represents the current state of the Kredis deployment
                type: string
              podsToDelete:
                description: |-
                  PodsToDelete contains pod names that are ready to be deleted after scale-down operations.
                  The operator deletes these pods directly instead of relying on StatefulSet.
                items:
                  type: string
                type: array
              readyReplicas:
                description: Number of ready replicas
                format: int32
                type: integer
              replicas:
                description: Total number of replicas
                format: int32
                type: integer
              scaleDownReady:
                description: |-
                  ScaleDownReady indicates that all scale-down operations are complete and pods can be deleted.
                  This is set to true when all nodes in PendingScaleDown have been safely removed from the cluster.
                type: boolean
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
