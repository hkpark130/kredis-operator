apiVersion: cache.docker.direa.synology.me/v1alpha1
kind: Kredis
metadata:
  labels:
    app.kubernetes.io/name: kredis
    app.kubernetes.io/instance: kredis-sample
    app.kubernetes.io/part-of: kredis-operator
    app.kubernetes.io/managed-by: kustomize
    app.kubernetes.io/created-by: kredis-operator
    app.kubernetes.io/name-prefix: kredis-operator
  name: kredis-sample
  namespace: kredis-operator-system
spec:
  masters: 3 # Redis 마스터 노드 수
  replicas: 1 # 각 마스터당 슬레이브(복제본) 노드 수
  maxMemory: "700Mi" # redis.conf maxmemory
  basePort: 6379
  image: "docker.direa.synology.me/redis-cluster:8.2-rc1"
  resources:
    limits:
      cpu: "1"
      memory: "1Gi"
    requests:
      cpu: 500m         # 100m → 500m로 증가 (CPU % 계산 정상화)
      memory: "512Mi"
  # Autoscaling 설정 (테스트용으로 낮은 임계값 사용)
  autoscaling:
    enabled: true
    minMasters: 3             # 최소 마스터 수
    maxMasters: 10            # 최대 마스터 수
    minReplicasPerMaster: 1   # 최소 레플리카 수
    maxReplicasPerMaster: 5   # 최대 레플리카 수
    memoryScaleUpThreshold: 70   # Memory 70% 이상 → Master 추가
    memoryScaleDownThreshold: 10 # Memory 10% 이하 → Master 감소
    cpuScaleUpThreshold: 70      # CPU 70% 이상 → Replica 추가
    cpuScaleDownThreshold: 20    # CPU 10% 이하 → Replica 감소
    scaleUpStabilizationWindowSeconds: 10   # 스케일업 대기 시간 (테스트용 짧게) 보통 60초
    scaleDownStabilizationWindowSeconds: 60 # 스케일다운 대기 시간 보통 10분 (600)
  exporter:
    enabled: true
    image: "bitnami/redis-exporter:latest"
    port: 9121
